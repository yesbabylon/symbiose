<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<title>Contrat de réservation</title>
<style type="text/css">
@page {
  margin: 1cm;
}
body {
    margin: 0;
    padding: 0;
    margin-top: 300px;
    margin-bottom: 35px;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 0.7em;
    text-align: justify;
    width: 100%;
}

h2 {
    margin-top: 8px;
    margin-bottom: 0;
    font-size: 21px;
}

h3 {
    margin-top: 0;
    margin-bottom: 0;
    font-size: 15px;
}

div, table, table tr td {
    font-family: Arial, Helvetica, sans-serif;
}

div.header,
div.footer {
    box-sizing: border-box;
    border: 0;
    margin: 0;
    padding: 0;
    position: fixed;
    width: 100%;
    overflow: hidden;
}

div.inner {
    height: auto;
    box-sizing: border-box;
    border: none;
}

div.inner p {
    margin: 0;
}

div.inner .wrapper {
    margin: 0px;
    margin-top: 20px;
    padding: 0px;
    border: none;
}

div.inner .wrapper table {
    page-break-inside: auto;
    border: solid 1px black;
}

div.inner .wrapper table tr td {
    border-right: solid 1px black;
    border-bottom: solid 1px lightgrey;
}

div.inner .wrapper table tr td:last-child {
    border-right: none;
}

div.inner .wrapper table tr:last-child td {
    border-bottom: none;
    border-bottom: solid 1px black;
}

div.inner .intro {
    margin-top: 20px;
}

div.trailer {
    margin: 0;
    padding: 0;
    width: 100%;
    overflow: visible;
    z-index: 100;
}

div.trailer .wrapper table {
    page-break-inside: avoid;
}

div.header {
    top: 0;
    left: 0;
    height: 327px;
}

div.header table {
    width: 100%;
    border-spacing: 0px;
    border-collapse: separate;
    border: solid 1px rgb(204, 204, 204);
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
}

div.footer {
    bottom: 0;
    left: 0;
    height: 30px;
    overflow: visible;
    z-index: 200;
    font-size: 0.8em !important;
}

hr {
    page-break-after: always;
    border: 0;
}
</style>

</head>

<body>

<div class="header">
    <div style="position: absolute; height: 150px; width: 350px; z-index: -1;">
        <img src="{{ header_img_url }}" width="350" height="100" border="0" />
        <div style="margin-left: 8px;">
            <h3>{{ company_name}}</h3>
            {{ company_address }}<br />
            Numéro d'entreprise: {{ company_reg_number }}
        </div>
    </div>
    <div style="position: absolute; top: 20px; right: 0px; width: 280px; height: 103px; font-size: 13px; text-align: left;">
        {{ customer_name }}<br />
        {{ customer_address1 }}<br />
        {{ customer_address2 }}<br />
        {% if customer_has_vat > 0 %}
            TVA {{ customer_vat }}
        {% endif %}
        {% if attn_name|length > 0 %}
            <br /><b>À l'attention de:</b><br />
            {{ attn_name }}
        {% endif %}
    </div>

    <!-- spacer -->
    <div style="position: relative; height: 150px; width: 100%;">
        <div style="position: absolute; top: 130px; right: 0; height: 19px; width: 100%; text-align: right;">Le {{ date }}</div>
    </div>

    <table cellpadding="0" cellspacing="0">
        <tr valign="top">
            <td colspan="2" style=" font-size: 20px; text-align: center; border-bottom: solid 1px rgb(204, 204, 204); width: 100%; height: 20px;  padding-left: 7px; overflow: hidden;">Contrat {{ code }}</td>
        </tr>
        <tr valign="top">
            <td style="width: 50%; padding: 5px;">
                <div style="margin-bottom: 5px; margin-top: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Votre séjour à </b></div> <div style="display: inline-block;">{{ center }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px; vertical-align: top;"></div> <div style="display: inline-block;">{{ center_address1 }} <br /> {{ center_address2 }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px; vertical-align: top;"><b>Contact</b></div> <div style="display: inline-block;">{{ center_contact1 }} <br /> {{ center_contact2 }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Période</b></div> <div style="display: inline-block;">{{ period }}</div>
                </div>
            </td>
            <td style="width: 50%; padding: 5px; background-color: rgb(204, 204, 204); ">
                <div style="margin-bottom: 5px; margin-top: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Membre</b></div> <div style="display: inline-block; width: 230px; background-color: white; height: 15px; padding: 0 5px; overflow: hidden;">{{ member }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Contact</b> </div> <div style="display: inline-block; width: 230px; background-color: white; height: 15px; padding: 0 5px; overflow: hidden;">{{ contact_name }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Tél</b> </div> <div style="display: inline-block; width: 230px; background-color: white; height: 15px; padding: 0 5px; overflow: hidden;">{{ contact_phone }}</div>
                </div>
                <div style="margin-bottom: 5px;">
                    <div style="display: inline-block; width: 100px;"><b>Email</b> </div> <div style="display: inline-block; width: 230px; background-color: white; height: 15px; padding: 0 5px; overflow: hidden;">{{ contact_email }}</div>
                </div>
            </td>
        </tr>
    </table>

</div>

<div class="footer">
    <p style="text-align: center;">
        {{ company_name}} - {{ company_address }}
        <br />
        Numéro d'entreprise: {{ company_reg_number }} - IBAN : {{ company_iban }}
        <br />
        Email: {{ company_email }} - Web: {{ company_website }} - Tel {{ company_phone }}
        {% if company_fax %}
            - {{ company_fax }}
        {% endif %}
    </p>
</div>

<div class="inner">
    <div class="intro">
        {{ contract_header_html | raw }}
    </div>
    <div class="wrapper">
        <table width="100%" cellpadding="4" cellspacing="0">
            <thead style="border: solid 1px black; border-left: 0px; border-right: 0px;">
                <tr>
                <th width="45%" style="padding-left: 7px; font-weight: bold; text-align: left;">
                    Libellé produit
                </th>
                <th width="8%" style="font-weight: bold; text-align: left;  border-left: solid 1px black; padding-right: 7px;">
                    Qté
                </th>
                <th width="8%" style="font-weight: bold; text-align: left;  border-left: solid 1px black; padding-right: 7px;">
                    Gté
                </th>
                <th width="10%" style="font-weight: bold; text-align: right;  border-left: solid 1px black; padding-right: 7px;">
                    Prix unit.
                </th>
                <th width="8%" style="font-weight: bold; text-align: right;  border-left: solid 1px black; padding-right: 7px;">
                    Rem%
                </th>
                <th width="8%" style="font-weight: bold; text-align: right;  border-left: solid 1px black; padding-right: 7px;">
                    {% if (company_has_vat == false) or (company_vat_number is null) or (company_vat_number == '') %}
                        Taxes
                    {% else %}
                        TVA
                    {% endif %}
                </th>
                <th width="13%" style="font-weight: bold; text-align: right;  border-left: solid 1px black; padding-right: 7px;">
                    {% if (company_has_vat == false) or (company_vat_number is null) or (company_vat_number == '') %}
                        Prix
                    {% else %}
                        Prix HT
                    {% endif %}
                </th>
            </tr>
            </thead>
            <!-- for each line -->
            {% for line in lines %}
                <tr valign="top">
                    <td width="45%">
                        {% if line.is_group %}
                            <b>{{ line.name }}</b>
                        {% else %}
                            {{ line.name }}
                        {% endif %}
                    </td>
                    <td width="8%" style="text-align: center;">
                        {{ line.qty }}
                    </td>
                    <td width="8%" style="text-align: center;">
                        {{ line.free_qty }}
                    </td>
                    <td width="10%" style="text-align: right;">
                        {% if line.unit_price is not null %}
                            {{ line.unit_price | format_money() }}
                        {% endif %}
                    </td>
                    <td width="8%" style="text-align: right;">
                        {% if line.discount is not null %}
                            {{ line.discount | format_number(style='percent') }}
                        {% endif %}
                    </td>
                    <td width="8%" style="text-align: right;">
                        {% if line.vat_rate is not null and company_has_vat %}
                            {{ line.vat_rate | format_number(style='percent') }}
                        {% endif %}
                    </td>
                    <td width="13%" style="text-align: right;">
                        {% if line.total is not null %}
                            {{ line.total | format_money() }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>

<div class="trailer">
    <div class="wrapper" style="margin-top: -1px;">
        <table width="100%" style="border: 0px; border-right: solid 1px black;" cellpadding="4" cellspacing="0">
            <tr valign="top">
                <td width="87%" style="text-align: right; padding-right: 10px;">
                    TOTAL HT
                </td>
                <td width="13%" style="text-align: right; border-left: solid 1px black; border-bottom: solid 1px black;">
                    {{ total | format_money() }}
                </td>
            </tr>
            {% for tax_label, tax_total in tax_lines %}
            {% if (tax_total > 0.0) %}
            <tr>
                <td style="text-align: right; padding-right: 10px;">
                    {{tax_label}}
                </td>
                <td style="text-align: right; border-left: solid 1px black; border-bottom: solid 1px black;">
                    {{ tax_total | format_money() }}
                </td>
            </tr>
            {% endif %}
            {% endfor %}
            <tr>
                <td style="text-align: right; padding-right: 10px;">
                    <b>TOTAL DU SÉJOUR TTC</b>
                </td>
                <td style="text-align: right; border-left: solid 1px black; border-bottom: solid 1px black;">
                    <b>{{ price | format_money() }}</b>
                </td>
            </tr>
        </table>
    </div>

    {% if benefit_lines | length > 0  %}
    <div class="important">
        <p><b>Votre avantage déjà inclus:</b></p>
        <table style="border: solid 1px black; width: 100%;">
            <tr>
                <td style="width: 80%;"><b>Categorie tarifaire</b></td>
                <td style="text-align: center;"><b>Avantage</b></td>
                <td style="text-align: center;"><b>/ Total</b></td>
            </tr>
            {% for benefit_line in benefit_lines %}
            <tr>
                <td>{{ benefit_line.name }}</td>
                <td style="text-align: center;">{{ benefit_line.value | format_money() }}</td>
                <td style="text-align: center;">{{ (100*benefit_line.value/(price+benefit_line.value)) | round }} %</td>
            </tr>
            {% endfor %}
        </table>
        <p>Veuillez noter que cet avantage est proportionnel aux spécificités de cette réservation, qu'il n'est donc pas fixe et pourra évoluer en cas de modification de votre réservation ou lors de réservations ultérieures.</p>
    </div>
    {% endif %}

</div>

{% if fundings | length > 0  %}
<div style="margin-top: 50px; page-break-inside: avoid;">
    <div style="margin: 0px 0px 20px 0px;"><b><u>Echéancier des paiements:</u></b></div>
    <table width="100%" cellpadding="4" cellspacing="0" style="border: solid 1px black; border-collapse: collapse; page-break-inside: avoid;">
        <tr valign="top">
            <th width="25%" style="text-align: left;">
                Paiement
            </th>
            <th width="25%">
                À payer avant le
            </th>
            <th width="25%">
                Déjà payé?
            </th>
            <th width="25%" style="text-align: right;">
                Montant
            </th>
        </tr>

        <!-- for each line -->
        {% for funding in fundings %}
            <tr valign="top">
                <td width="25%">
                    {{ funding.name }}
                </td>
                <td width="25%" style="text-align: center;">
                    {{ funding.due_date }}
                </td>
                <td width="25%" style="text-align: center;">
                    {% if funding.is_paid == true %}
                        oui
                    {% else %}
                        non
                    {% endif %}
                </td>
                <td width="25%" style="text-align: right;">
                    {{ funding.due_amount  | format_money() }}
                </td>
            </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

{% if consumptions_map | length > 0  %}
<div style="position: relative; margin-top: 30px; page-break-inside: avoid;">
    <div class="consumptions">
        <b>Détail des consommations:</b>
    </div>

    <table style="border: solid 1px black; border-collapse: collapse; width: 100%;" border="1">
        <tr>
            <td style="width: 40%;"><b>Jour</b></td>
            <td style="text-align: center; width: 15%"><b>Petits déjeuners</b></td>
            <td style="text-align: center; width: 15%"><b>Repas midi</b></td>
            <td style="text-align: center; width: 15%"><b>Repas soir</b></td>
            <td style="text-align: center; width: 15%"><b>Nuitées</b></td>
        </tr>
        {% for date_index,map in consumptions_map %}
        {% if date_index != 'total' %}
        <tr>
            <td>{{ date_index }}</td>
            <td style="text-align: center;">{{ map[1] | default("0") }}</td><!-- meals in the morning -->
            <td style="text-align: center;">{{ map[2] | default("0") }}</td><!-- meals at lunchtime -->
            <td style="text-align: center;">{{ map[4] | default("0")}}</td><!-- meals in the evening -->
            <td style="text-align: center;">{{ map['night'] | default("0")}}</td>
        </tr>
        {% endif %}
        {% endfor %}
        <tr>
            <td><b>TOTAL</b></td>
            <td style="text-align: center; font-weight: bold;">{{ consumptions_map['total'][1] | default("0") }}</td>
            <td style="text-align: center; font-weight: bold;">{{ consumptions_map['total'][2] | default("0") }}</td>
            <td style="text-align: center; font-weight: bold;">{{ consumptions_map['total'][4] | default("0")}}</td>
            <td style="text-align: center; font-weight: bold;">{{ consumptions_map['total']['night'] | default("0")}}</td>
        </tr>
    </table>

</div>
{% endif %}

<div class="notice">{{ contract_notice_html | raw }}</div>

{% if installment_amount > 0 %}
<div style="position: relative; margin-top: 40px; border: solid 2px black; height: 180px; page-break-inside: avoid;">
    <div style="font-size: 15px; padding-left: 15px; padding-top: 15px;">
        Le montant de <b>{{ installment_amount | format_money() }}</b> doit être versé avant le <b>{{ installment_date}}</b>
    </div>
    <div style="padding-top: 20px; padding-left: 15px; font-size: 15px;">
        <b>COMMUNICATION : {{ installment_reference }}</b><br />
        IBAN : {{ company_iban }}<br />
        BIC : {{ company_bic }}<br />
        <br />
        {{ company_name}}<br />
        {{ company_address }}<br />
    </div>
    <div style="position: absolute; right: 10px; top: 15px;">
        <img src="{{ installment_qr_url }}" width= "150" height="150" />
    </div>
</div>
{% endif %}

<div style="margin-top: 50px;">
    <table style="width: 100%; page-break-inside: avoid;">
        <tr>
            <td style="width: 60%;">
                <div>Membre {{ member }}
                    {% if contact_name|length > 0 %}
                    <br />{{ contact_name }}
                    {% endif %}
                </div>
                <div>
                    Par la présente, j'atteste avoir lu et accepte:
                    <ul>
                        <li>La présente proposition de contrat</li>
                        <li>Les conditions générales de vente</li>
                        <li>Le règlement d'ordre intérieur</li>
                        <li>Les conditions spécifiques (si reçues)</li>
                    </ul>
                </div>

            </td>
            <td style="width: 40%;">
                <div>Date et Signature</div>
                <div style="border: solid 1px black; width: 100%; height: 80px;"></div>

            </td>
        </tr>
    </table>
</div>


</body>
</html>